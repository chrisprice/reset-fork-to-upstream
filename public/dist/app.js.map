{"version":3,"sources":["src/app.js"],"names":[],"mappings":";;;;;;;;;;IAAO,CAAC,2BAAM,QAAQ;;QACf,wBAAwB;;IACxB,EAAE,2BAAM,UAAU;;IACX,IAAI,WAAO,WAAW,EAA5B,EAAE;;AAEV,IAAM,YAAY,QAAM,QAAQ,CAAC,MAAM,MAAG,CAAC;AAC3C,IAAM,aAAa,QAAM,YAAY,kBAAe,CAAC;AACrD,IAAM,aAAa,QAAM,YAAY,WAAQ,CAAC;AAC9C,IAAM,cAAc,QAAM,YAAY,YAAS,CAAC;;;AAGhD,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;AAClB,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC;;QACR,qDAAqD;;IAEtD,KAAK;AACC,UADN,KAAK,GACI;;;wBADT,KAAK;;AAET,MAAI,CAAC,KAAK,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;AAC7B,MAAI,CAAC,KAAK,GAAG,EAAE,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;AAClC,MAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;AACrC,MAAI,CAAC,KAAK,GAAG,EAAE,CAAC,eAAe,EAAE,CAAC;AAClC,MAAI,CAAC,aAAa,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;AACrC,MAAI,CAAC,YAAY,GAAG,EAAE,CAAC,QAAQ,CAAC,YAAM;AACrC,OAAM,IAAI,GAAG,MAAK,aAAa,EAAE,CAAC;AAClC,OAAI,IAAI,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,IAAI,EAAE;AACpC,WAAO,IAAI,CAAC;IACZ;GACD,CAAC,CAAC;AACH,MAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;AAC3C,MAAI,CAAC,uBAAuB,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;AAC/C,MAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;AAC3C,MAAI,CAAC,kBAAkB,GAAG,EAAE,CAAC,QAAQ,CAAC;UAAM,MAAK,YAAY,EAAE,IAAI,CAAC,MAAK,mBAAmB,EAAE;GAAA,CAAC,CAAC;AAChG,MAAI,CAAC,YAAY,GAAG,EAAE,CAAC,QAAQ,CAAC;UAAM,MAAK,YAAY,EAAE,IACxD,MAAK,mBAAmB,EAAE,UAAQ,MAAK,YAAY,EAAE,CAAC,KAAK,SAAI,MAAK,YAAY,EAAE,CAAC,IAAI,AAAE;GAAA,CAAC,CAAC;;AAE5F,MAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC,QAAQ,CAAC,YAAM;AAC5C,OAAI,CAAC,MAAK,mBAAmB,EAAE,EAAE;AAChC,WAAO;IACP;AACD,UAAO,MAAK,mBAAmB,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACxE,QAAI,MAAM,CAAC,GAAG,KAAK,MAAM,CAAC,SAAS,EAAE;AACpC,YAAO,CAAC,SAAS,EAAE,CAAC;KACpB,MAAM,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,SAAS,EAAE;AAC3C,YAAO,CAAC,OAAO,EAAE,CAAC;KAClB,MAAM,IAAI,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE;AAC3C,YAAO,CAAC,OAAO,EAAE,CAAC;KAClB,MAAM;AACN,YAAO,CAAC,KAAK,EAAE,CAAC;KAChB;AACD,WAAO,OAAO,CAAC;IACf,EAAE;AACF,aAAS,EAAE,CAAC;AACZ,WAAO,EAAE,CAAC;AACV,SAAK,EAAE,CAAC;AACR,WAAO,EAAE,CAAC;IACV,CAAC,CAAC;GACH,CAAC,CAAC;AACH,MAAI,CAAC,sBAAsB,GAAG,EAAE,CAAC,QAAQ,CAAC,YAAM;AAC/C,OAAM,OAAO,GAAG,MAAK,mBAAmB,EAAE,CAAC;AAC3C,UAAO,OAAO,IAAK,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,KAAK,GAAG,CAAC,AAAC,CAAC;GAC1E,CAAC,CAAC;AACH,MAAI,CAAC,kBAAkB,GAAG,EAAE,CAAC,QAAQ,CAAC;UACrC,MAAK,mBAAmB,EAAE,IAAI,CAAC,MAAK,sBAAsB,EAAE;GAAA,CAAC,CAAC;;AAE/D,MAAI,CAAC,YAAY,CAAC,SAAS,CAAC;UAAM,MAAK,uBAAuB,EAAE;GAAA,CAAC,CAAC;;AAElE,MAAI,CAAC,YAAY,EAAE,CACjB,IAAI,CAAC,UAAA,CAAC;UAAI,MAAK,KAAK,CAAC,IAAI,CAAC;GAAA,EAAE,UAAA,CAAC;UAAI,MAAK,KAAK,CAAC,IAAI,CAAC;GAAA,CAAC,CAAC;EACrD;;cArDI,KAAK;AAuDV,MAAI;UAAA,cAAC,GAAG,EAAE;;;AACT,WAAO,CAAC,CAAC,IAAI,CAAC;AACZ,SAAI,EAAE,KAAK;AACX,QAAG,EAAE,GAAG;AACR,aAAQ,EAAE,MAAM;AAChB,cAAS,EAAE;AACT,qBAAe,EAAE,IAAI;MACpB;KACH,CAAC,CACD,IAAI,CAAC,UAAA,CAAC;aAAK,MAAK,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;KAAC,EAAE,UAAA,CAAC;YAAI,MAAK,gBAAgB,CAAC,CAAC,CAAC;KAAA,CAAC,CAAC;IACrE;;AAED,OAAK;UAAA,eAAC,GAAG,EAAE;;;iCACW,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,iBAAiB,CAAC;;;;QAArD,SAAS;;AACjB,WAAO,CAAC,CAAC,IAAI,CAAC;AACZ,SAAI,EAAE,MAAM;AACZ,QAAG,EAAE,GAAG;AACR,aAAQ,EAAE,MAAM;AAChB,YAAO,EAAE;AACR,oBAAc,EAAE,SAAS;MACzB;AACD,cAAS,EAAE;AACT,qBAAe,EAAE,IAAI;MACpB;KACH,CAAC,CACD,IAAI,CAAC,UAAA,CAAC;aAAK,MAAK,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;KAAC,EAAE,UAAA,CAAC;YAAI,MAAK,gBAAgB,CAAC,CAAC,CAAC;KAAA,CAAC,CAAC;IACrE;;AAED,kBAAgB;UAAA,0BAAC,CAAC,EAAE;AACnB,YAAQ,CAAC,CAAC,MAAM;AACf,UAAK,CAAC,CAAC;AACP,UAAK,GAAG;AACP,UAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACrB,YAAM;AAAA,AACP,UAAK,GAAG,CAAC;AACT;AACC,UAAI,CAAC,KAAK,CAAC,8EAA8E,CAAC,CAAC;AAC3F,YAAM;AAAA,KACP;IACD;;AAED,eAAa;UAAA,yBAAG;AACf,QAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;AACpB,aAAQ,GAAG,cAAc,CAAC;KAC1B,MAAM;AACN,aAAQ,GAAG,aAAa,CAAC;KACzB;IACD;;AAED,cAAY;UAAA,wBAAG;;;AACd,WAAO,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAC7B,IAAI,CAAC,UAAA,KAAK,EAAI;AACd,WAAK,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,UAAA,IAAI;cAAK,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,EAAE,IAAI,CAAA;MAAC,CAAC,CAAC,CAAC;KACpF,CAAC,CAAC;IACJ;;AAED,qBAAmB;UAAA,+BAAG;AACrB,gBAAU,aAAa,SAAI,IAAI,CAAC,YAAY,EAAE,CAAC,KAAK,SAAI,IAAI,CAAC,YAAY,EAAE,CAAC,IAAI,CAAG;IACnF;;AAED,2BAAyB;UAAA,qCAAG;AAC3B,QAAI,CAAC,uBAAuB,CAAC,CAAC,IAAI,CAAC,uBAAuB,EAAE,CAAC,CAAC;IAC9D;;AAED,yBAAuB;UAAA,mCAAG;;;AACzB,QAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;AAC/B,QAAI,IAAI,CAAC,YAAY,EAAE,EAAE;AACxB,SAAI,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,CACnC,IAAI,CAAC,UAAA,WAAW;aAAI,MAAK,uBAAuB,CAAC,WAAW,CAAC;MAAA,CAAC,CAAC;KACjE;IACD;;AAED,yBAAuB;UAAA,iCAAC,WAAW,EAAE;AACpC,eAAW,CAAC,UAAU,GACrB,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAC/B,GAAG,CAAC,UAAA,IAAI;YAAK;AACb,UAAI,EAAE,IAAI;AACV,SAAG,EAAE,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,GAAG;AACnC,eAAS,EAAE,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,SAAS;MAC/C;KAAC,CAAC,CAAC;AACN,QAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC;IACtC;;AAED,iBAAe;UAAA,yBAAC,MAAM,EAAE;AACvB,WAAO,AAAC,MAAM,CAAC,GAAG,KAAK,MAAM,CAAC,SAAS,GAAI,SAAS,GAChD,AAAC,CAAC,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,SAAS,GAAI,MAAM,GAC1C,AAAC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,GAAI,QAAQ,GAC5C,SAAS,CAAC;IACd;;AAED,OAAK;UAAA,iBAAG;;;AACP,QAAI,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE;AACzB,WAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;KACpD;AACD,QAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;AAC/B,QAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;AAC/B,QAAI,CAAC,KAAK,MAAI,IAAI,CAAC,mBAAmB,EAAE,aAAU,CAChD,IAAI,CAAC,UAAA,WAAW;YAAI,MAAK,uBAAuB,CAAC,WAAW,CAAC;KAAA,CAAC,CAAC;IACjE;;;;QAzJI,KAAK;;;AA4JX,EAAE,CAAC,aAAa,CAAC,IAAI,KAAK,EAAE,CAAC,CAAC","file":"src/app.js","sourcesContent":["import $ from \"jquery\";\r\nimport \"jquery-ui/autocomplete\";\r\nimport ko from \"knockout\";\r\nimport {v4 as uuid} from \"node-uuid\";\r\n\r\nconst API_BASE_URL = `${location.origin}/`;\r\nconst API_REPOS_URL = `${API_BASE_URL}/secure/repos`;\r\nconst API_LOGIN_URL = `${API_BASE_URL}/login`;\r\nconst API_LOGOUT_URL = `${API_BASE_URL}/logout`;\r\n\r\n// keep knockout-jqAutocomplete happy\r\nglobal.jQuery = $;\r\nglobal.ko = ko;\r\nimport \"knockout-jqAutocomplete/src/knockout-jqAutocomplete\"\r\n\r\nclass Model {\r\n\tconstructor() {\r\n\t\tthis.error = ko.observable();\r\n\t\tthis.ready = ko.observable(false);\r\n\t\tthis.loggedIn = ko.observable(false);\r\n\t\tthis.repos = ko.observableArray();\r\n\t\tthis._selectedRepo = ko.observable();\r\n\t\tthis.selectedRepo = ko.computed(() => {\r\n\t\t\tconst repo = this._selectedRepo();\r\n\t\t\tif (repo && repo.Owner && repo.Name) {\r\n\t\t\t\treturn repo;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.selectedRepoDetails = ko.observable();\r\n\t\tthis.viewSelectedRepoDetails = ko.observable();\r\n\t\tthis.userEnteredFullName = ko.observable();\r\n\t\tthis.loadingRepoDetails = ko.computed(() => this.selectedRepo() && !this.selectedRepoDetails());\r\n\t\tthis.resetEnabled = ko.computed(() => this.selectedRepo() &&\r\n\t\t\tthis.userEnteredFullName() === `${this.selectedRepo().Owner}/${this.selectedRepo().Name}`);\r\n\r\n\t\tthis.selectedRepoSummary = ko.computed(() => {\r\n\t\t\tif (!this.selectedRepoDetails()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\treturn this.selectedRepoDetails().BranchList.reduce((summary, branch) => {\r\n\t\t\t\tif (branch.SHA === branch.ParentSHA) {\r\n\t\t\t\t\tsummary.unchanged++;\r\n\t\t\t\t} else if (!branch.SHA && branch.ParentSHA) {\r\n\t\t\t\t\tsummary.created++;\r\n\t\t\t\t} else if (branch.SHA && !branch.ParentSHA) {\r\n\t\t\t\t\tsummary.deleted++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsummary.reset++;\r\n\t\t\t\t}\r\n\t\t\t\treturn summary;\r\n\t\t\t}, {\r\n\t\t\t\tunchanged: 0,\r\n\t\t\t\tcreated: 0,\r\n\t\t\t\treset: 0,\r\n\t\t\t\tdeleted: 0\r\n\t\t\t});\r\n\t\t});\r\n\t\tthis.selectedRepoHasChanges = ko.computed(() => {\r\n\t\t\tconst summary = this.selectedRepoSummary();\r\n\t\t\treturn summary && (summary.created + summary.deleted + summary.reset > 0);\r\n\t\t});\r\n\t\tthis.selectedRepoInSync = ko.computed(() =>\r\n\t\t\tthis.selectedRepoDetails() && !this.selectedRepoHasChanges());\r\n\r\n\t\tthis.selectedRepo.subscribe(() => this.loadSelectedRepoDetails());\r\n\r\n\t\tthis.refreshRepos()\r\n\t\t\t.then(d => this.ready(true), e => this.ready(true));\r\n\t}\r\n\r\n\t_get(url) {\r\n\t\treturn $.ajax({\r\n\t\t\t\ttype: \"GET\",\r\n\t\t\t\turl: url,\r\n\t\t\t\tdataType: \"JSON\",\r\n\t\t\t\txhrFields: {\r\n\t\t\t\t  withCredentials: true\r\n\t\t\t   }\r\n\t\t\t})\r\n\t\t\t.then(d => (this.loggedIn(true), d), e => this._handleAjaxError(e));\r\n\t}\r\n\r\n\t_post(url) {\r\n\t\tconst [,csrfToken] = document.cookie.match(/session=([^;]+)/);\r\n\t\treturn $.ajax({\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\turl: url,\r\n\t\t\t\tdataType: \"JSON\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"X-Csrf-Token\": csrfToken\r\n\t\t\t\t},\r\n\t\t\t\txhrFields: {\r\n\t\t\t\t  withCredentials: true\r\n\t\t\t   }\r\n\t\t\t})\r\n\t\t\t.then(d => (this.loggedIn(true), d), e => this._handleAjaxError(e));\r\n\t}\r\n\r\n\t_handleAjaxError(e) {\r\n\t\tswitch (e.status) {\r\n\t\t\tcase 0:\r\n\t\t\tcase 401:\r\n\t\t\t\tthis.loggedIn(false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 500:\r\n\t\t\tdefault:\r\n\t\t\t\tthis.error(\"it's not you it's me, we've grown apart, or it might be you, I'm not sure...\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleSession() {\r\n\t\tif (this.loggedIn()) {\r\n\t\t\tlocation = API_LOGOUT_URL;\r\n\t\t} else {\r\n\t\t\tlocation = API_LOGIN_URL;\r\n\t\t}\r\n\t}\r\n\r\n\trefreshRepos() {\r\n\t\treturn this._get(API_REPOS_URL)\r\n\t\t\t.then(repos => {\r\n\t\t\t\tthis.repos(repos.map(repo => (repo.FullName = repo.Owner + '/' + repo.Name, repo)));\r\n\t\t\t});\r\n\t}\r\n\r\n\t_getSelectedRepoUrl() {\r\n\t\treturn `${API_REPOS_URL}/${this.selectedRepo().Owner}/${this.selectedRepo().Name}`;\r\n\t}\r\n\r\n\ttoggleSelectedRepoDetails() {\r\n\t\tthis.viewSelectedRepoDetails(!this.viewSelectedRepoDetails());\r\n\t}\r\n\r\n\tloadSelectedRepoDetails() {\r\n\t\tthis.selectedRepoDetails(null);\r\n\t\tif (this.selectedRepo()) {\r\n\t\t\tthis._get(this._getSelectedRepoUrl())\r\n\t\t\t\t.then(repoDetails => this._setSelectedRepoDetails(repoDetails));\r\n\t\t}\r\n\t}\r\n\r\n\t_setSelectedRepoDetails(repoDetails) {\r\n\t\trepoDetails.BranchList =\r\n\t\t\tObject.keys(repoDetails.Branches)\r\n\t\t\t\t.map(name => ({\r\n\t\t\t\t\tName: name,\r\n\t\t\t\t\tSHA: repoDetails.Branches[name].SHA,\r\n\t\t\t\t\tParentSHA: repoDetails.Branches[name].ParentSHA\r\n\t\t\t\t}));\r\n\t\tthis.selectedRepoDetails(repoDetails);\r\n\t}\r\n\r\n\tbranchClassName(branch) {\r\n\t\treturn (branch.SHA === branch.ParentSHA) ? 'success' :\r\n\t\t\t   (!branch.SHA && branch.ParentSHA) ? 'info' :\r\n\t\t\t   (branch.SHA && !branch.ParentSHA) ? 'danger' :\r\n\t\t\t   'warning';\r\n\t}\r\n\r\n\treset() {\r\n\t\tif (!this.resetEnabled()) {\r\n\t\t\tthrow new Error(\"That wasn't supported to happen.\");\r\n\t\t}\r\n\t\tthis.userEnteredFullName(null);\r\n\t\tthis.selectedRepoDetails(null);\r\n\t\tthis._post(`${this._getSelectedRepoUrl()}/resets`)\r\n\t\t\t.then(repoDetails => this._setSelectedRepoDetails(repoDetails));\r\n\t}\r\n}\r\n\r\nko.applyBindings(new Model());\r\n"]}